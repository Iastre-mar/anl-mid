---
title: "R Notebook"
output: html_notebook
---

# Домашнеезадание
В файле parfume.csv приведены результаты маркетингового исследования, целью которого было выяснить предпочтения девушек от 18 до 25 лет относительно рекламы парфюмерной воды Black &White от Carolina Herrera(название изменено). Все девушки, участвовавшие в исследовании, были случайным образом распределены между контрольной и тестовой группой. Девушкам в контрольной группе показывали рекламный видеоролик в цветном варианте, а в тестовой - видеоролик в черно-белом варианте. Через некоторое время после демонстрации ролика фиксировалось, хотела бы девушка приобрести парфюмерную воду (значение 1) или нет (значение 0). По итогам анализа данных необходиморешить, какой из вариантов роликов оставить и использовать в дальнейшем.Описание данных:
id -  id респондента,
age - возраст респондента,
group - группа (тестовая иликонтрольная),
vote - решение о покупке (1 - хочет купить, 0 - не хочет, 2 - нет ответа).
## Задание Часть 1: R
1.Загрузите данные из файла parfume.csv в датафрейм parf.
2.Оставьте в датафрейме только те строки, которые соответствуют девушкам, предоставившим ответна вопрос о решении купить/не купить парфюмерную воду. В последующих заданиях необходимо работать с обновленным датафреймом.
3.Для описания имеющихся данных постройте две столбиковые диаграммы (bar plots), которые показывают, сколько девушек хотели/не хотели бы приобрести парфюмерную воду Black & Whiteв контрольной и тестовой группе (одна диаграмма для одной группы). Приведите графики впорядок, добавьте содержательные подписи и названия.
Подсказка:используйте функцию table()для получения числа нулей и единиц в столбце vote, а затем воспользуйтесь графической функцией barplot().
4.Сохраните в вектор test ответы на вопрос о решении купить/не купить парфюмерную воду всех девушек, которые были в тестовой группе. Сохраните в вектор control ответы на вопросо решении купить/не купить парфюмерную воду всех девушек, которые были в контрольной группе.Подсказка:сначала отберите строки, соответствующие этим девушкам, а потом извлеките из полученного датафрема нужный столбец.
5.Сформулируйте нулевую гипотезу и одностороннюю альтернативную гипотезу, выдвигаемые для принятия решения о выборе одного из двух рекламных роликов (какой из роликов предпочлабольшая доля девушек). Считайте, что по мнению экспертов, ожидается, что черно-белый ролик будет более предпочтительным.
6.Используя бутстрэп с числом итераций N= 1000, найдите p-value для разности долей девушек,которые захотели купитьBlack & Whiteв контрольной и тестовой группах. Для воспроизводимости результатов зафиксируйте стартовую точку с помощью set.seed(123). Не забудьте о центрировании, которое обсуждалось в практическом задании 
1.7.Сделайте статистический вывод на основе полученного p-value, приняв уровень значимости равным 5% (отвергается или не отвергается нулевая гипотеза). Сделайте содержательный вывод о выборе рекламного ролика (какой из вариантов лучше)
```{r}
library(tidyverse)
```

```{r}
# 1,2
parf <- read.csv("parfume.csv", row.names="id")
parf <- parf[3:dim(parf)[2]]
parf <- parf[parf$vote != 2,]
parf
```
```{r}
# 3
parf$vote_factor = factor(parf$vote, labels = c("Не согласны купить", "Согласны купить"))
ggplot(parf, aes(vote_factor)) +
  geom_bar() +
  facet_grid(.~group) +
  labs(title = "Результаты опроса девушек по группам", x = "vote") +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# 4
test <- as.vector(parf[parf$group == "test",]$vote)
control <- as.vector(parf[parf$group == "control",]$vote)
```
# 5 
Пусть H0 : mean(control) == mean(test), а H1 : mean(control) < mean(test)
```{r}
# Код по использованию тестов

ns_control <- sum(control)
ns_test <- sum(test)

n_control <- length(control)
n_test <- length(test)
prop.test(c(ns_control, ns_test), c(n_control, n_test), alternative = "less")
```
```{r}
# 6
N <- 1000

conv_control <- mean(control)
conv_test <- mean(test)
p <- conv_test - conv_control
cat("разница между выборками равна :", p, "\n")

set.seed(123)
differences <- rep(NA, N)
for (i in 1:N){
  s1 <- sample(control, replace = TRUE)
  s2 <- sample(test, replace = TRUE)
  p1 <- mean(s1)
  p2 <- mean(s2)
  dif <- p2 -p1
  differences[i] <- dif
}
head(differences)
```

```{r}
sum(differences >= p) / N
```
```{r}
dif_df <- data.frame(differences)
ggplot(dif_df, aes(x=differences)) + geom_histogram(fill = "lightblue", color="navy") + geom_vline(xintercept = p, color = "red", lty=2)
# Видим, что значения группируются не вокруг нуля
```
```{r}
sum((differences - mean(differences)) > p) / N
```

```{r}
dif2 <- differences - mean(differences)
```

```{r}
dif_df2 <- data.frame(dif2)
ggplot(dif_df2, aes(x=dif2)) + geom_histogram(fill = "lightblue", color="navy") + geom_vline(xintercept = p, color = "red", lty=2)
```

# 7
Второй лучше