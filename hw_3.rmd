---
title: "Домашнее задание"
output:
  pdf_document: default
  html_document:
    df_print: paged
header-includes:
- \usepackage[russian]{babel}
- \usepackage{hyperref}
- \hypersetup{ colorlinks = true, urlcolor = blue}
---

### Задание 1

1. Загрузите файл `housing.csv` с данными по ценам на квартиры в пригородах Бостона (одна строка – один пригород) и сохраните его в датафрейм. Описание показателей:

* `RM` – среднее число комнат;
 	
* `LSTAT` – процент жителей низкого материального статуса:
 	
* `MEDV` – медианное значение цены на дом в тысячах долларов.

     Посмотрите на датафрейм – откройте его в отдельном окне RStudio.
```{r}
df1 <- read.csv("housing.csv", sep="\t")
View(df1)
```

2. Выведите на экран первые и последние строки в датафрейме. Выведите информацию о типах столбцов в таблице («структуру» датафрейма). Проверьте, что все столбцы с числовыми данными считались как числовые, а не текстовые.
```{r}
head(df1)
```


```{r}
tail(df1)
```
```{r}
str(df1)
```

3. Выведите на экран сводные характеристики всех столбцов в датафрейме – описательные статистики. Наблюдаются ли серьезные отличия в медианных и средних значениях показателей (один из признаков наличия аномальных наблюдений или выбросов)? Насколько велик разброс значений цен на квартиры, если мы сравним минимальное значение и максимальное? Есть ли в каком-нибудь показателе с содержательной точки зрения нетипичные значения (отрицательные цены и прочее)?
```{r}
summary(df1)
```
1) Вроде отличается не сильно
2) 45 тысяч долларов
3) LON, но мне дана расшивровка только 3 столбцов

4. Используя стандартные средства R (без `tidyverse`), добавьте в датафрейм столбец `MEDV_N`, который содержит медианные цены на квартиры из столбца `MEDV`, измеренные в долларах (не в тысячах долларов).
```{r}
df1$MEDV_N <- df1$MEDV * 1000
```

5. Используя стандартные средства R (без `tidyverse`), сохраните в датафрейм `small` только те строки, которые соответствуют пригородам, где медианная цена за квартиру (`MEDV`) больше 400 тысяч, но меньше 500 тысяч. Сколько таких пригородов?

    *Подсказка:* для определения числа строк в датафрейме можно воспользоваться функцией `nrow()`.
```{r}
# Найду для больше 40 и меньше 50 тысяч так как ответ у задания в той форме, в которой оно задано 0
small <- df1[df1$MEDV < 50 & df1$MEDV > 40, ]
```

6. Используя средства библиотеки `tidyverse` (`dplyr`), создайте столбец `MEDV_LOG`, который содержит натуральные логарифмы значений медианных цен на квартиры из столбца `MEDV`.
```{r}
library(tidyverse)
df1 <- df1 %>% mutate(MEDV_LOG = log(df1$MEDV, exp(1)))
```

7. Используя средства библиотеки `tidyverse` (`dplyr`), выведите на экран в отдельной вкладке строки, которые соответствуют пригородам, где процент населения, низкого по материальному статусу, составляет не менее 30%.
```{r}
df1 %>% filter(LSTAT>=30)
```

8. Используя стандартные средства R (без `ggplot2`), постройте гистограмму для показателя `LSTAT`. Добавьте заголовок и подписи к осям, измените цвет. Что можно сказать о распределении процента населения с низким материальным статусом? Какие значения преобладают, есть ли скошенность в сторону слишком больших или слишком маленьких значений? Сохраните полученный график в файл `hist.png`, используя код R (не кнопку *Export* в окне с графиком).
```{r}
hist(df1$LSTAT,
     main = "Гистограмма распределения бедности",
     ylab = "Число домохозяйств",
     xlab = "Процент жителей низкого материального статуса",
     col = "red")
dev.copy(png, "hist.png")
dev.off()
```

9. Выполните предыдущий пункт, но уже используя средства библиотеки `tidyverse` (графика с `ggplot2`).
```{r}
ggplot(df1, aes(LSTAT)) +
  geom_histogram(bins=38, fill = "skyblue", color = "navy") +
  labs(title="Гистограмма распределения бедности", x="Процент жителей низкого материального статуса", y="Число домохозяйств") +
  scale_x_continuous(breaks = scales::breaks_width(5)) +
  scale_y_continuous(breaks = scales::breaks_width(5))
dev.copy(png, "hist2.png")
dev.off()
```

### Задание 2

1. Загрузите данные из файла `flats.csv` и сохраните в датафрейм. Посмотрите на датафрейм.
```{r}
flat <- read.csv("flats.csv", header=TRUE, row.names=1)
View(flat)
```


2. Сгруппируйте данные по показателю `brick` (дом из кирпича или нет). Определите, сколько домов каждого типа присутствует в данных. Каких домов больше?
```{r}
flat %>% group_by(brick) %>% count()
```
Больше не каменных
3. Сгруппируйте данные по показателю `brick` (дом из кирпича или нет). Определите среднюю цену на квартиры (`price`) по каждой группе. Квартиры в каких домах, в среднем, дороже?
```{r}
flat %>% group_by(brick) %>% summarise(mean(price))
```
В каменных

4. С помощью библиотеки `ggplot2` постройте гистограммы для цен на квартиры с разбиением на группы по показателю `walk` (находится ли дом в шаговой доступности от метро или нет). По группам – отдельное окно-фасетка для каждой группы в рамках одного графика.
Распределение цен в какой группе менее скошенное (вправо или влево)?
```{r}
flat$walk <- factor(flat$walk, labels = c ("Не в шаговой доступности", "В шаговой доступности"))
ggplot(flat, aes(price)) + 
  geom_histogram(binwidth = 15) +
  facet_grid(.~walk)
```
Влево
```{r}
ggplot(flat, aes(price)) + 
  geom_histogram(binwidth = 15) +
  facet_grid(~walk) +
  scale_x_continuous(limits=c(0,250))
```

5. С помощью библиотеки `ggplot2` постройте диаграммы рассеяния для показателей `totsp` (общая площадь квартиры в квадратных метрах) и `price` (цена квартиры), сделав цвет точек зависимым от показателя `walk`, а размер – от показателя `kitsp` (площадь кухни).
```{r}
ggplot(data=flat, aes(x = totsp, y = price, color = walk, size = kitsp)) +
  geom_point() +
  labs(title="Зависимость цены квартиры от размера", x="Размер квартиры", y="Цена")
```


    *Подсказка:* с размером точек можно поступать точно так же, как с цветом, либо указывать внутри `geom_point()`, либо внутри `aes()` в зависисимости от постановки задачи. Аргумент для настройки размера точки – `size`.

